import React, {useState} from 'react';
import {StyleSheet, Text, View} from 'react-native';
import VideoSelector from './VideoSelector';
import FrameSelector from './FrameSelector';
import ProgressBar from './ProgressBar';
import FrameExtractor from './FrameExtractor';
import Settings from './Settings';
import Notification from './Notification';

const App = () => {
  const [videoInfo, setVideoInfo] = useState(null);
  const [frameOption, setFrameOption] = useState(null);
  const [quality, setQuality] = useState('high');
  const [resolution, setResolution] = useState('original');
  const [progress, setProgress] = useState(0);
  const [extracting, setExtracting] = useState(false);
  const [notification, setNotification] = useState(null);

  const onVideoSelect = info => {
    setVideoInfo(info);
    setFrameOption(null);
  };

  const onFrameOptionSelect = option => {
    setFrameOption(option);
  };

  const onExtractStart = () => {
    setExtracting(true);
    setProgress(0);
    setNotification(null);
  };

  const onProgressUpdate = progress => {
    setProgress(progress);
  };

  const onExtractComplete = () => {
    setExtracting(false);
    setNotification('Extraction complete');
  };

  return (
    <View style={styles.container}>
      <Text style={styles.title}>Frame Extractor</Text>
      <VideoSelector onSelect={onVideoSelect} />
      {videoInfo && (
        <View>
          <Text style={styles.videoInfoTitle}>Selected Video Info:</Text>
          <Text style={styles.videoInfo}>
            Title: {videoInfo.title} {'\n'}
            Duration: {videoInfo.duration} {'\n'}
            Format: {videoInfo.format} {'\n'}
            Audio Codec: {videoInfo.audioCodec} {'\n'}
            Video Codec: {videoInfo.videoCodec} {'\n'}
            Frame Rate: {videoInfo.fps} fps {'\n'}
            Total Frames: {videoInfo.totalFrames} {'\n'}
          </Text>
          <FrameSelector
            videoInfo={videoInfo}
            onSelect={onFrameOptionSelect}
            selectedOption={frameOption}
          />
          {frameOption && (
            <View>
              <Settings
                quality={quality}
                resolution={resolution}
                onQualityChange={setQuality}
                onResolutionChange={setResolution}
              />
              <FrameExtractor
                videoInfo={videoInfo}
                frameOption={frameOption}
                quality={quality}
                resolution={resolution}
                onStart={onExtractStart}
                onProgress={onProgressUpdate}
                onComplete={onExtractComplete}
              />
              <ProgressBar progress={progress} />
              {notification && <Notification message={notification} />}
            </View>
          )}
        </View>
      )}
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 20,
    backgroundColor: '#F5FCFF',
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    marginBottom: 10,
  },
  videoInfoTitle: {
    fontSize: 18,
    fontWeight: 'bold',
    marginTop: 20,
    marginBottom: 10,
  },
  videoInfo: {
    fontSize: 16,
    marginBottom: 20,
  },
});

export default App;